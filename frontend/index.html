<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Scholarship Application</title>
<style>
  :root { --pad: 12px; --radius: 12px; --shadow: 0 2px 8px rgba(0,0,0,.08); }
  * { box-sizing: border-box; font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; }
  body { margin: 0; background: #f7f7f9; color: #111; }
  header { padding: 16px; background: #111827; color: #fff; }
  header h1 { margin: 0; font-size: 20px; }
  header p { margin: 4px 0 0; opacity: .8; font-size: 13px; }
  main { max-width: 840px; margin: 20px auto; padding: 0 14px 40px; display: grid; gap: 14px; }
  .card { background: #fff; border-radius: var(--radius); box-shadow: var(--shadow); padding: var(--pad); }
  .hdr { font-weight: 600; font-size: 12px; text-transform: uppercase; color: #555; letter-spacing: .02em; }
  .grid { display: grid; gap: 10px; grid-template-columns: 1fr 1fr; }
  .row4 { display: grid; gap: 10px; grid-template-columns: repeat(4, 1fr); }
  input, select { width: 100%; padding: 8px 10px; border: 1px solid #dcdce0; border-radius: 8px; }
  .btns { display: flex; gap: 8px; flex-wrap: wrap; }
  button { padding: 8px 12px; border-radius: 10px; border: 1px solid #dcdce0; background: #fff; cursor: pointer; font-weight: 600; }
  button.primary { background: #1f2937; color: #fff; border-color: #1f2937; }
  .decision { background: #0b1020; color: #fff; border-radius: 12px; padding: 12px; display: grid; grid-template-columns: 2fr 1fr; align-items:center; }
  .decision .lab { font-size: 14px; opacity: .9; }
  .decision .val { font-size: 28px; font-weight: 700; }
  .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 12px;}
</style>
</head>
<body>
  <header>
    <h1 id="title">Scholarship Application</h1>
    <p id="subtitle">Select criteria. Server decides.</p>
  </header>
  <main>
    <section class="card">
      <div class="row4">
        <div><div class="hdr">Applicant</div><input id="applicant" type="text" placeholder="Name"></div>
        <div><div class="hdr">Household/App #</div><input id="household" type="text" placeholder="APP-..."></div>
        <div><div class="hdr">Application Date</div><input id="appDate" type="date"></div>
        <div><div class="hdr">Date Scored</div><input id="scoreDate" type="date"></div>
      </div>
    </section>

    <section class="card">
      <h3>Select Criteria</h3>
      <div id="factors" class="grid"></div>
      <div class="btns" style="margin-top:10px;">
        <button class="primary" onclick="submitScore()">Submit</button>
        <button onclick="resetForm()">Reset</button>
      </div>
    </section>

    <section class="card" id="results" style="display:none;">
      <div class="decision">
        <div>
          <div class="lab">Decision</div>
          <div class="val" id="decision">—</div>
        </div>
        <div style="text-align:right;">
          <div class="lab">Index</div>
          <div class="val" id="index">0.0</div>
        </div>
      </div>
      <div class="mono" id="sig" style="margin-top:8px;"></div>
    </section>
  </main>

<script>
const API_BASE = "https://scholarship-scorecard.onrender.com"
let CONFIG = null;

async function loadConfig() {
  const res = await fetch(API_BASE + "/api/config");
  if (!res.ok) { alert("Failed to load config"); return; }
  CONFIG = await res.json();
  document.getElementById("title").textContent = CONFIG.ui?.title || "Scholarship Application";
  document.getElementById("subtitle").textContent = CONFIG.ui?.subtitle || "";
  renderFactors(CONFIG.factors || []);
}

function renderFactors(factors) {
  const wrap = document.getElementById("factors");
  wrap.innerHTML = "";
  factors.forEach(f => {
    const div = document.createElement("div");
    const lab = document.createElement("div"); lab.className="hdr"; lab.textContent = f.label;
    const input = document.createElement("select");
    (f.options||[]).forEach(opt => { const o = document.createElement("option"); o.value = opt; o.textContent = opt; input.appendChild(o); });
    input.id = "f_" + f.key;
    div.appendChild(lab);
    div.appendChild(input);
    wrap.appendChild(div);
  });
}

function collectPayload() {
  const applicant = document.getElementById("applicant").value;
  const factors = (CONFIG.factors || []).map(f => {
    const el = document.getElementById("f_"+f.key);
    const val = String(el.value);
    return { key: f.key, value: val };
  });
  return { applicant, factors };
}

async function submitScore() {
  const payload = collectPayload();
  const res = await fetch(API_BASE + "/api/score", {
    method: "POST",
    headers: { "content-type": "application/json" },
    body: JSON.stringify(payload)
  });
  if (!res.ok) { const t = await res.text(); alert("Error: " + t); return; }
  const data = await res.json();
  document.getElementById("decision").textContent = data.decision || "—";
  document.getElementById("index").textContent = Number(data.index || 0).toFixed(1);
  document.getElementById("sig").textContent = "signature=" + (data.signature || "");
  document.getElementById("results").style.display = "block";
}

function resetForm() { document.getElementById("results").style.display = "none"; }

loadConfig();
</script>
</body>
</html>
